<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Properties | Rental Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
</head>
<body class="bg-white text-zinc-900 antialiased selection:bg-emerald-100 selection:text-emerald-900 min-h-screen">

    <!-- Top Header -->
    <header class="fixed top-0 right-0 left-0 md:left-64 h-14 bg-white border-b border-zinc-100 z-40">
        <div class="h-full flex items-center justify-between px-6">
            <div class="md:hidden">
                <button class="p-2 hover:bg-zinc-50 rounded-md transition-colors">
                    <iconify-icon icon="lucide:menu" width="20" class="text-zinc-600"></iconify-icon>
                </button>
            </div>
            <div class="flex items-center gap-4 ml-auto">
                <a href="create-listing.html" class="text-sm font-medium bg-emerald-600 text-white px-4 py-2 rounded-md hover:bg-emerald-700 transition-colors flex items-center gap-2">
                    <iconify-icon icon="lucide:plus" width="14"></iconify-icon>
                    Add a Property
                </a>
                <div class="flex items-center gap-2 px-3 py-1.5 hover:bg-zinc-50 rounded-md cursor-pointer transition-colors">
                    <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-700 text-xs font-medium">R</div>
                    <span class="text-sm font-medium text-zinc-900 hidden sm:block">Rita</span>
                    <iconify-icon icon="lucide:chevron-down" width="16" class="text-zinc-400"></iconify-icon>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Navigation -->
    <aside class="fixed top-0 left-0 bottom-0 w-64 bg-white border-r border-zinc-100 z-50 overflow-y-auto hidden md:block">
        <div class="p-6 border-b border-zinc-100">
            <a href="index.html" class="flex items-center gap-2">
                <div class="w-6 h-6 bg-emerald-600 rounded-md flex items-center justify-center text-white">
                    <iconify-icon icon="lucide:building-2" width="16" stroke-width="1.5"></iconify-icon>
                </div>
                <span class="text-sm font-semibold tracking-tight">RENTAL MANAGER</span>
            </a>
        </div>
        <nav class="p-4 space-y-1">
            <a href="dashboard.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:layout-dashboard" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
            <a href="properties.html" class="flex items-center gap-3 px-3 py-2 bg-emerald-50 border border-emerald-100 rounded-md text-emerald-700">
                <iconify-icon icon="lucide:home" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Properties</span>
                <span class="flex h-2 w-2 rounded-full bg-emerald-500 ml-auto"></span>
            </a>
            <a href="applications.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:users" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Applications</span>
            </a>
            <a href="payments.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:wallet" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Payments</span>
            </a>
            <a href="leases.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:file-text" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Residents & Leases</span>
            </a>
            <a href="reports.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:bar-chart-3" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Reports</span>
            </a>
            <a href="maintenance.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:wrench" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Maintenance</span>
            </a>
            <a href="expenses.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                <iconify-icon icon="lucide:receipt" width="18" stroke-width="1.5"></iconify-icon>
                <span class="text-sm font-medium">Expenses</span>
            </a>
            <div class="pt-4 mt-4 border-t border-zinc-100 space-y-1">
                <a href="messages.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                    <iconify-icon icon="lucide:mail" width="18" stroke-width="1.5"></iconify-icon>
                    <span class="text-sm font-medium">Messages</span>
                </a>
                <a href="help.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                    <iconify-icon icon="lucide:help-circle" width="18" stroke-width="1.5"></iconify-icon>
                    <span class="text-sm font-medium">Help</span>
                </a>
                <div class="account-dropdown">
                    <button class="w-full flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors" onclick="toggleAccountDropdown()">
                        <iconify-icon icon="lucide:settings" width="18" stroke-width="1.5"></iconify-icon>
                        <span class="text-sm font-medium">Account</span>
                        <iconify-icon icon="lucide:chevron-down" width="14" class="text-zinc-400 ml-auto account-chevron transition-transform"></iconify-icon>
                    </button>
                    <div class="account-submenu hidden mt-1 ml-4 space-y-1">
                        <a href="my-account.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors text-sm">
                            My Account
                        </a>
                        <a href="banks-cards.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors text-sm">
                            Banks & Cards
                        </a>
                        <a href="billing-history.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors text-sm">
                            Billing History
                        </a>
                    </div>
                </div>
                <a href="feedback.html" class="flex items-center gap-3 px-3 py-2 text-zinc-600 hover:bg-zinc-50 rounded-md transition-colors">
                    <iconify-icon icon="lucide:message-square" width="18" stroke-width="1.5"></iconify-icon>
                    <span class="text-sm font-medium">Provide Feedback</span>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="md:ml-64 pt-14 min-h-screen bg-zinc-50">
        <div class="p-6">
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-medium tracking-tight text-zinc-900 mb-2">Properties</h1>
                <p class="text-zinc-500">Manage all your rental properties in one place.</p>
            </div>

            <!-- Properties Overview -->
            <div class="border border-zinc-100 rounded-lg overflow-hidden bg-white">
                <div class="bg-zinc-50/50 px-4 py-3 border-b border-zinc-100 flex justify-between items-center">
                    <span class="text-sm font-medium text-zinc-900">Your Properties</span>
                </div>
                <div class="p-4">
                    <div id="propertiesGrid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Properties will be loaded dynamically -->
                        <div class="border border-zinc-100 rounded-lg overflow-hidden hover:shadow-md transition-all relative">
                            <div class="aspect-video bg-zinc-100 relative">
                                <div class="absolute top-2 left-2 px-2 py-0.5 rounded bg-white text-xs font-medium text-zinc-600">Active</div>
                                <button onclick="togglePropertyMenu('default-1')" class="absolute top-2 right-2 w-8 h-8 bg-emerald-600 rounded-md flex items-center justify-center hover:bg-emerald-700 transition-colors z-10">
                                    <iconify-icon icon="lucide:more-horizontal" width="16" class="text-white"></iconify-icon>
                                </button>
                                <div id="menu-default-1" class="hidden absolute top-10 right-2 bg-white rounded-lg shadow-lg border border-zinc-200 z-50 min-w-[200px] py-1">
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Edit Listing</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Edit Property</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Applications</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Residents</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Payments</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Invite to Apply</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Generate Rent Comp Report</a>
                                    <div class="border-t border-zinc-200 my-1"></div>
                                    <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">Delete Property</a>
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="text-sm font-medium text-zinc-900 mb-1">123 Main Street</h3>
                                <p class="text-xs text-zinc-500 mb-3">Los Angeles, CA 90001</p>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-zinc-500">1 Unit</span>
                                    <span class="text-emerald-600 font-medium">$1,800/mo</span>
                                </div>
                            </div>
                        </div>
                        <div class="border border-zinc-100 rounded-lg overflow-hidden hover:shadow-md transition-all relative">
                            <div class="aspect-video bg-zinc-100 relative">
                                <div class="absolute top-2 left-2 px-2 py-0.5 rounded bg-white text-xs font-medium text-yellow-600">Vacant</div>
                                <button onclick="togglePropertyMenu('default-2')" class="absolute top-2 right-2 w-8 h-8 bg-emerald-600 rounded-md flex items-center justify-center hover:bg-emerald-700 transition-colors z-10">
                                    <iconify-icon icon="lucide:more-horizontal" width="16" class="text-white"></iconify-icon>
                                </button>
                                <div id="menu-default-2" class="hidden absolute top-10 right-2 bg-white rounded-lg shadow-lg border border-zinc-200 z-50 min-w-[200px] py-1">
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Edit Listing</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Edit Property</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Applications</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Residents</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Payments</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Invite to Apply</a>
                                    <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Generate Rent Comp Report</a>
                                    <div class="border-t border-zinc-200 my-1"></div>
                                    <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">Delete Property</a>
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="text-sm font-medium text-zinc-900 mb-1">456 Oak Avenue</h3>
                                <p class="text-xs text-zinc-500 mb-3">San Diego, CA 92101</p>
                                <div class="flex items-center justify-between text-xs">
                                    <span class="text-zinc-500">1 Unit</span>
                                    <span class="text-zinc-400">$2,100/mo</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Help Button -->
    <button class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-colors flex items-center justify-center z-30">
        <iconify-icon icon="lucide:help-circle" width="24"></iconify-icon>
    </button>

    <script>
        function toggleAccountDropdown() {
            const submenu = document.querySelector('.account-submenu');
            const chevron = document.querySelector('.account-chevron');
            submenu.classList.toggle('hidden');
            chevron.classList.toggle('rotate-180');
        }

        // Toggle property menu dropdown
        function togglePropertyMenu(listingId) {
            // Close all other menus first
            document.querySelectorAll('[id^="menu-"]').forEach(menu => {
                if (menu.id !== `menu-${listingId}`) {
                    menu.classList.add('hidden');
                }
            });

            // Toggle the clicked menu
            const menu = document.getElementById(`menu-${listingId}`);
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }

        // Delete property function
        function deleteProperty(listingId) {
            if (confirm('Are you sure you want to delete this property? This action cannot be undone.')) {
                const listings = JSON.parse(localStorage.getItem('publishedListings') || '[]');
                const updatedListings = listings.filter(l => l.id !== listingId);
                localStorage.setItem('publishedListings', JSON.stringify(updatedListings));
                
                // Reload the listings
                loadSavedListings();
            }
        }

        // Close menus when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('[onclick*="togglePropertyMenu"]') && !event.target.closest('[id^="menu-"]')) {
                document.querySelectorAll('[id^="menu-"]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });

        // Load and display saved listings
        function loadSavedListings() {
            const listings = JSON.parse(localStorage.getItem('publishedListings') || '[]');
            const propertiesGrid = document.getElementById('propertiesGrid');

            if (!propertiesGrid) return;

            // Clear existing properties (keep the default ones if no listings)
            if (listings.length > 0) {
                // Remove default properties
                const defaultCards = propertiesGrid.querySelectorAll('.border.border-zinc-100');
                defaultCards.forEach(card => card.remove());
            }

            // Add each saved listing
            listings.forEach(listing => {
                const propertyCard = document.createElement('div');
                propertyCard.className = 'border border-zinc-100 rounded-lg overflow-hidden hover:shadow-md transition-all relative';
                
                const addressParts = listing.address.split(',');
                const streetAddress = addressParts[0]?.trim() || listing.address;
                const cityState = addressParts.slice(1).join(',').trim() || '';

                const monthlyRent = listing.unit?.monthlyRent || '0';
                const formattedRent = `$${parseInt(monthlyRent).toLocaleString()}/mo`;

                const unitName = listing.unit?.name || '';
                const beds = listing.unit?.beds || '';
                const baths = listing.unit?.baths || '';
                const size = listing.unit?.size || '';
                const hasPhotos = listing.media?.photos > 0;

                const menuId = `menu-${listing.id}`;
                
                propertyCard.innerHTML = `
                    <div class="aspect-video bg-zinc-100 relative">
                        ${hasPhotos 
                            ? `<img src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800&h=600&fit=crop" alt="${streetAddress}" class="w-full h-full object-cover">`
                            : ''
                        }
                        <div class="absolute top-2 left-2 px-2 py-0.5 rounded bg-white text-xs font-medium ${listing.status === 'active' ? 'text-emerald-600' : 'text-yellow-600'}">
                            ${listing.status === 'active' ? 'Active' : 'Vacant'}
                        </div>
                        <button onclick="togglePropertyMenu('${listing.id}')" class="absolute top-2 right-2 w-8 h-8 bg-emerald-600 rounded-md flex items-center justify-center hover:bg-emerald-700 transition-colors z-10">
                            <iconify-icon icon="lucide:more-horizontal" width="16" class="text-white"></iconify-icon>
                        </button>
                        <div id="${menuId}" class="hidden absolute top-10 right-2 bg-white rounded-lg shadow-lg border border-zinc-200 z-50 min-w-[200px] py-1">
                            <a href="create-listing-step6.html" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Edit Listing</a>
                            <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Edit Property</a>
                            <a href="applications.html" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Applications</a>
                            <a href="leases.html" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Residents</a>
                            <a href="payments.html" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Payments</a>
                            <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Invite to Apply</a>
                            <a href="#" class="block px-4 py-2 text-sm text-zinc-900 hover:bg-zinc-50 transition-colors">Generate Rent Comp Report</a>
                            <div class="border-t border-zinc-200 my-1"></div>
                            <a href="#" onclick="deleteProperty('${listing.id}'); return false;" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">Delete Property</a>
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="text-sm font-medium text-zinc-900 mb-1">${streetAddress}</h3>
                        <p class="text-xs text-zinc-500 mb-3">${cityState}</p>
                        <div class="flex items-center justify-between text-xs mb-2">
                            <span class="text-zinc-500">${unitName ? `Unit ${unitName}` : '1 Unit'}</span>
                            <span class="text-emerald-600 font-medium">${formattedRent}</span>
                        </div>
                        ${beds || baths || size ? `
                        <div class="flex items-center gap-2 text-xs text-zinc-500">
                            ${beds ? `<span>${beds} Beds</span>` : ''}
                            ${beds && baths ? '<span>•</span>' : ''}
                            ${baths ? `<span>${baths} Baths</span>` : ''}
                            ${(beds || baths) && size ? '<span>•</span>' : ''}
                            ${size ? `<span>${parseInt(size).toLocaleString()} Sq Ft</span>` : ''}
                        </div>
                        ` : ''}
                    </div>
                `;

                propertiesGrid.appendChild(propertyCard);
            });
        }

        // Load listings when page loads
        document.addEventListener('DOMContentLoaded', loadSavedListings);
    </script>

</body>
</html>
